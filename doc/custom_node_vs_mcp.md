# カスタムノード開発のメリット・デメリット分析

「n8n標準のMCP機能で連携できるなら、なぜわざわざカスタムノードを作るのか？」という疑問に対する分析です。

## 結論
**定型的・高頻度な処理や、即時性が求められるアラート対応**には「カスタムノード」が圧倒的に有利です。
一方、**非定型な調査・分析や、対話的なトラブルシューティング**には「MCP」が適しています。
これらは競合するものではなく、**補完関係**にあります。

---

## 1. カスタムノードのメリット (Pros)

### ① 安定性と確実性 (Stability)
*   **決まった動作**: 「このクエリを投げて、件数を返す」という処理が100%確実に実行されます。
*   **AIの誤解釈なし**: MCP (AI Agent) は、プロンプトの解釈揺れにより、意図しないクエリを投げたり、結果フォーマットが変わる可能性があります。自動化フロー（定期レポート作成など）では、この「揺れ」は致命的になることがあります。

### ② パフォーマンスとコスト (Performance & Cost)
*   **高速**: 直接APIを叩くため、数ミリ秒〜数百ミリ秒で完了します。AIによる推論（数秒〜数十秒）を挟みません。
*   **低コスト**: LLMのトークン料金がかかりません。高頻度（毎分など）で実行するフローでは大きな差になります。

### ③ トリガー機能 (Trigger Capability) - **重要**
*   **Phase 2の実装予定機能**: Webhookを受け取ってワークフローを開始する機能は、MCPでは（通常）できません。
*   MCPは基本的に「こちらから聞きに行く（Pull）」ツールです。アラートが飛んできた瞬間に動く（Push）仕組みは、ノードとして実装する必要があります。

### ④ 使いやすさ (UX)
*   **GUI設定**: リージョン選択（US/EU）や、クエリの入力欄などがGUIで提供されるため、誰でも迷わず設定できます。プロンプトエンジニアリングが不要です。

---

## 2. カスタムノードのデメリット (Cons)

### ① 開発・保守コスト (Maintenance)
*   **コード記述**: TypeScriptでの実装が必要です（今回行っている作業）。
*   **API変更への追従**: New RelicのAPI仕様が変わった場合、コードを修正してアップデートする必要があります。

### ② 柔軟性の限界 (Flexibility)
*   **実装した機能しか使えない**: 「NRQL実行」機能を実装しなければ、NRQLは使えません。
*   一方、MCPなら「よしなにやって」と言えば、公開されているツールの中から自律的に方法を探してくれる可能性があります。

---

## 比較まとめ

| 特徴 | カスタムノード (本プロジェクト) | MCP (AI Agent) |
| :--- | :--- | :--- |
| **主な用途** | 定型業務、アラート検知、定期レポート | 障害調査、ログ分析、対話的クエリ |
| **実行速度** | 速い | 遅い (LLMの推論時間が必要) |
| **コスト** | サーバー代のみ | LLMトークン費用が発生 |
| **確実性** | 高い (Deterministic) | プロンプト依存 (Probabilistic) |
| **トリガー** | **可能 (Webhook)** | 苦手 (基本はActionのみ) |
| **保守** | コード修正が必要 | サーバー側の更新で自動反映 |

## 推奨される使い分け
*   **カスタムノード**: 「毎日朝9時にトランザクション数をSlackに通知する」「アラートが来たらチケットを切る」といった、**カチッとした自動化**に。
*   **MCP**: 「なんかエラー増えてるから原因調べて」とAIに投げかけ、**柔軟にインサイトを得る**用途に。
